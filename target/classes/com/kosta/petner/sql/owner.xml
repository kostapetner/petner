<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.owner">
	
	<insert id="regist" parameterType="com.kosta.petner.bean.PetInfo">
		insert into pet_info(pet_no
							,user_no
							,file_no
							,pet_kind
							,pet_specie
							,pet_name
							,pet_age
							,pet_weight
							,pet_gender
							,pet_neutral
							,pet_info
		) values(pet_no_seq.nextval 
				,#{user_no, jdbcType=INTEGER}
				,#{file_no, jdbcType=INTEGER}
				,#{pet_kind, jdbcType=VARCHAR}
				,#{pet_specie, jdbcType=VARCHAR}
				,#{pet_name, jdbcType=VARCHAR}
				,#{pet_age, jdbcType=INTEGER}
				,#{pet_weight, jdbcType=INTEGER}
				,#{pet_gender, jdbcType=VARCHAR}
				,#{pet_neutral, jdbcType=VARCHAR}
				,#{pet_info, jdbcType=VARCHAR}
		)
	</insert>
	
	<!-- 221115_DSC  -->
	<select id="getPetInfo" parameterType="int" resultType="com.kosta.petner.bean.PetInfo">
		<![CDATA[
			SELECT * FROM PET_INFO
			WHERE USER_NO = #{user_no}
		]]> 
	</select>
	<!-- select * from pet_info where user_no = #{user_no} -->
	<select id= "getPetByUserNo" parameterType = "Integer" resultType= "com.kosta.petner.bean.PetInfo" >
	<![CDATA[		
		SELECT pet.*, ft.SERVER_FILENAME 
		FROM PET_INFO pet 
		LEFT JOIN FILE_TB ft ON pet.FILE_NO = ft.FILE_NO 
		WHERE pet.USER_NO = #{user_no}
	]]>	
	</select>
	
	<select id= "getPetByPetNo" parameterType = "Integer" resultType= "com.kosta.petner.bean.PetInfo" >
	<![CDATA[
		select * from pet_info where pet_no = #{pet_no}
	]]>	
	</select>
	
	<select id= "getFileByPetNo" parameterType = "Integer" resultType= "String" >
	<![CDATA[
		SELECT SERVER_FILENAME
		FROM FILE_TB ft, PET_INFO pi
		WHERE pi.pet_no = #{pet_no} and ft.FILE_NO  = pi.file_no
	]]>	
	</select>
	
	<insert id="insertRequireServiceFrom" parameterType="com.kosta.petner.bean.CareService">
	<![CDATA[
		insert into care_service(
			 service_no
			,user_no
			,pet_no
			,zipcode
			,addr
			,addr_detail
			,service
			,st_date
			,end_date
			,request_money
			,request_title
			,request_detail
			,status
			,reg_date
			,file_no
		)values(
			 service_no_seq.nextval
			,#{user_no, jdbcType=INTEGER}
			,#{pet_no, jdbcType=INTEGER}
			,#{zipcode, jdbcType=INTEGER}
			,#{addr, jdbcType=VARCHAR}
			,#{addr_detail, jdbcType=VARCHAR}
			,#{service, jdbcType=VARCHAR}
			,#{st_date}
			,#{end_date}
			,#{request_money, jdbcType=INTEGER}
			,#{request_title, jdbcType=VARCHAR}
			,#{request_detail, jdbcType=VARCHAR}
			,#{status, jdbcType=VARCHAR}
			,sysdate
			,#{file_no, jdbcType=INTEGER}
		)
	]]>	
	</insert>
	
	<select id="getServiceList" resultType="com.kosta.petner.bean.CareService" parameterType="Map">
	<![CDATA[
		select  service_no
				,user_no
				,pet_no
				,zipcode
				,addr
				,addr_detail
				,service
				,st_date
				,end_date
				,request_money
				,request_title
				,request_detail
				,status
				,TO_CHAR(reg_date,'YYYY/MM/DD') reg_date
		from (
			select row_number() over (order BY service_no desc) num, B.*
			from care_service B
			WHERE user_no = #{user_no}
			order by service_no desc
			)
		where num between #{row} and #{row}+9
		]]>
	</select>
	
	<!-- user_no가 조건으로 들어가는 게시글 수 -->
	<select id="csListCount" parameterType="Integer" resultType="Integer">
	<![CDATA[
		select count(*)
		from care_service
		where user_no = #{user_no}
	]]>	
	</select>
	
	<!-- care_service의 전체 게시글 수 -->
	<select id="csListAllCount" resultType="Integer">
	<![CDATA[
		select count(*)
		from care_service
	]]>	
	</select>
	
</mapper>
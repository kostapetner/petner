<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                        
<mapper namespace="mapper.qna">
	<insert id="insertQna" parameterType="com.kosta.petner.bean.Qna">
		<![CDATA[
			insert into qna (qna_no,user_id,qna_title,qna_content,file_no, qna_re_ref, qna_re_lev, qna_re_seq, qna_hit, reg_date)
			values(qna_seq.nextval,#{user_id},#{qna_title},#{qna_content},#{file_no, jdbcType=VARCHAR},
				#{qna_re_ref},#{qna_re_lev},#{qna_re_seq},#{qna_hit},sysdate)
		]]>
	</insert>
	
	<select id="selectMaxQnaNum" resultType="Integer">
		<![CDATA[
			select max(qna_no) from qna
		]]>
	</select>
	
	<select id="selectQnaList" resultType="com.kosta.petner.bean.Qna" parameterType="Integer">
		<![CDATA[
			select qna_no,user_id,qna_title,qna_content,file_no,qna_re_ref,
				qna_re_lev,qna_re_seq,qna_hit,reg_date 
			from (select row_number() over (order by qna_re_ref desc, qna_re_seq asc) num, Q.*
					from qna Q order by qna_re_ref desc, qna_re_seq asc)
			where num between #{row} and #{row}+9
		]]>
	</select>
	
	<select id="selectQnaCount" resultType="Integer">
		<![CDATA[
			select count(*) from qna
		]]>
	</select>
	
	<select id="selectQna" resultType="com.kosta.petner.bean.Qna" parameterType="Integer">
		<![CDATA[
			select * from qna where qna_no=#{qna_no} ORDER BY qna_no DESC
		]]>
	</select>
	
	<update id="updateQna" parameterType="com.kosta.petner.bean.Qna">
		<![CDATA[
			update qna set qna_title=#{qna_title}, qna_content=#{qna_content}
			where qna_no=#{qna_no}
		]]>
	</update>
	
	<update id="read">
		<![CDATA[
			UPDATE qna SET qna_hit = qna_hit + 1 WHERE qna_no=#{qna_no}
		]]>
	</update>
	
	<update id="updateQnaReReq" parameterType="com.kosta.petner.bean.Qna">
		<![CDATA[
			update qna set qna_re_seq=qna_re_seq+1
			where qna_re_ref=#{qna_re_ref} and qna_re_seq>#{qna_re_seq}
		]]>
	</update>
	
	<delete id="deleteQna" parameterType="Integer">
		<![CDATA[
			delete from qna where qna_no=#{qnaNum}
		]]>
	</delete>
	
	
	<update id="updateFileNoToQna" parameterType="com.kosta.petner.bean.Qna">
	<![CDATA[
		update qna
		set file_no = #{file_no}
		where qna_no = #{qna_no}
	]]>	
	</update>
	
	
</mapper>














                      
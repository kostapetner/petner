<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.review">
	<resultMap type="com.kosta.petner.bean.Review" id="ReviewResultMap">
		<id property="reviewNo" column="review_no"/>
		<id property="reviewActiveUser" column="review_active_user" />
		<id property="reviewPassiveUser" column="review_passive_user"/>
		<id property="title" column="title"/>
		<id property="content" column="content"/>
		<id property="rating" column="rating"/>
		<id property="reviewDate" column="review_date"/>
		
		
		<id property="reviewActiveUserId" column="review_active_user_id"/>
		<id property="reviewPassiveUserId" column="review_passive_user_id"/>
		
		<id property="profileName" column="profile_name"/>
	</resultMap>
	
	<resultMap type="com.kosta.petner.bean.Users" id="UsersResultMap">
		<id property="user_no" column="user_no"/>
		<id property="user_type" column="user_type"/>
		<id property="id" column="id"/>
		<id property="nickname" column="nickname"/>
		<id property="email" column="email"/>
		<id property="password" column="password"/>
		<id property="name" column="name"/>
		<id property="joindate" column="joindate"/>
		<id property="gender" column="gender"/>
		<id property="zipcode" column="zipcode"/>
		<id property="addr" column="addr"/>
		<id property="addr_detail" column="user_level"/>
		<id property="user_level" column="user_level"/>
		<id property="user_auth" column="user_auth"/>
		<id property="file_no" column="file_no"/>
	</resultMap>
	
	<insert id="writeReview"
		parameterType="com.kosta.petner.bean.Review">
		<![CDATA[
			insert into review(review_no, review_active_user, review_passive_user, title, content, rating
			, review_date)
			values(#{reviewNo}, #{reviewActiveUser}, #{reviewPassiveUser}, #{title}, #{content}
			, #{content}, #{rating}, sysdate)
		]]>
	</insert>
	
	<!-- 내가 작성한 리뷰 갯수 조회 -->
	<select id="writtenReviewConunt" resultType="Integer">
		<![CDATA[
			select Count(review_no) 
			from review
			where review_passive_user = #{reviewPassiveUser}
		]]>
	</select>
	
	<!-- 내가 받은 리뷰 갯수 조회 -->
	<select id="passiveReviewCount" resultType="Integer">
		<![CDATA[
			select Count(review_no) 
			from review
			where review_active_user = #{reviewActiveUser}
		]]>
	</select>
	
	<!-- 내가 작성한 리뷰 리스트 -->
	<select id="writtenReviewList"
		resultType="com.kosta.petner.bean.Review" parameterType="Integer">
		<![CDATA[
			select review_No, review_Active_User, review_Passive_User, title, content, rating, review_Date
			from review
			where review_active_user = #{reviewActiveUser}
			and review_no between #{row} and #{row}+5;
		]]>
		<!-- 63번째줄 이대로 쓰면 페이징 제대로 처리안됨 구현 잘 생각하기 -->
	</select>
	
	<!-- 내가 받은 리뷰 리스트 -->
	<select id="passiveReviewList"
		resultType="com.kosta.petner.bean.Review" parameterType="Integer">
		<![CDATA[
			select review_No, review_Active_User, review_Passive_User, title, content, rating, review_Date
			from review
			where review_active_user = #{reviewPassiveUser}
			and review_no between #{row} and #{row}+5;
		]]>
		<!-- 74번째줄 이대로 쓰면 페이징 제대로 처리안됨 구현 잘 생각하기 -->
	</select>
	
	<update id="updateReview" parameterType="com.kosta.petner.bean.Review" >
		<![CDATA[
			update review set title=#{title}, content=#{content}, rating=#{rating}
			where review_no=#{review_no}
		]]>
	</update>
	
</mapper>

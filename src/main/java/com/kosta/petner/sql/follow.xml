<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.follow">
	<resultMap type="com.kosta.petner.bean.Follow" id="FollowResultMap">
		<id property="followNo" column="follow_no"/>
		<id property="activeUser" column="active_user"/>
		<id property="passiveUser" column="passive_user"/>
		<id property="regDate" column="reg_date"/>
		
		<id property="activeUserId" column="active_user_id"/>
		<id property="passiveUserId" column="passive_user_id"/>
		
		<id property="profileNa3me" column="profile_name"/>
	</resultMap>
	
	<resultMap type="com.kosta.petner.bean.Users" id="UsersResultMap">
		<id property="user_no" column="user_no"/>
		<id property="user_type" column="user_type"/>
		<id property="id" column="id"/>
		<id property="nickname" column="nickname"/>
		<id property="email" column="email"/>
		<id property="password" column="password"/>
		<id property="name" column="name"/>
		<id property="joindate" column="joindate"/>
		<id property="gender" column="gender"/>
		<id property="zipcode" column="zipcode"/>
		<id property="addr" column="addr"/>
		<id property="addr_detail" column="user_level"/>
		<id property="user_level" column="user_level"/>
		<id property="user_auth" column="user_auth"/>
		<id property="file_no" column="file_no"/>
	</resultMap>
	
	<!-- 팔로우 기능 -->
	<insert id="follow">
		insert into follow(active_user, passive_user) values(#{activeUser}, #{passiveUser})
	</insert>
	
	<!-- 언팔로우 기능 -->
 	<delete id="unfollow">
 		delete from follow where active_user=#{activeUser} and passive_user=#{passiveUser}
 	</delete>
 	
 	<!-- 팔로우 유무 조회 기능 -->
 	<select id="isFollow" resultType="int">
 		select count(*) from follow where active_user=#{activeUser} and passive_user=#{passiveUser}
 	</select>
 	
 	<!-- 팔로우 리스트 조회 -->
 	<select id="selectActiveUserList" resultMap="FollowResultMap">
 		select 
 			active_user,
 			passive_user,
 			F.reg_date as reg_date,
 			U.id as passive_user_id,
 			I.profile_name as profile_name
 		from follow F
 		left outer join users U	<!-- Users 생각 잘해야됨 -->
 		on (F.passive_user = U.user_no)
 		left outer join user_imgs I	<!-- 여기서 유저프로필이미지 어케 가져올지 생각하기 -->
 		on (I.user_no = U.user_no)
 		where active_user=#{activeUser}
 		order by reg_date desc
 	</select>
 	
 	<!-- 팔로우 리스트 조회 -->
 	<select id="selectPassiveUserList" resultMap="FollowResultMap">
 		select
 			active_user,
 			passive_user,
 			F.reg_date as reg_date,
 			U.id as active_user_id,
 			I.profile_name as profile_name
 		from follow F
 		left outer join users U	<!-- Users 생각 잘해야됨 -->
 		on (F.active_user = U.user_no)
 		left outer join user_imgs I <!-- 여기서 유저프로필이미지 어케 가져올지 생각하기 -->
 		on (I.user_no = U.user_no)
 		where passive_user = #{passiveUser}
 		order by reg_date desc
 	</select>
 	
 	<!-- 탈퇴시 팔로우 삭제 -->
 	<delete id="deleteUserAllFollow">
 		delete from follow where active_user=#{active_user}
 	</delete>
</mapper>
